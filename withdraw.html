<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Withdraw - EarnZone</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'poppins': ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        primary: '#6366f1',
                        secondary: '#8b5cf6',
                        accent: '#22c55e',
                        dark: '#0f172a',
                    }
                }
            }
        }
    </script>
</head>
<body class="font-poppins bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen pb-20">
    <!-- Header -->
    <header class="bg-slate-900/80 backdrop-blur-lg sticky top-0 z-40 border-b border-slate-700/50">
        <div class="max-w-lg mx-auto px-4 py-3 flex items-center">
            <a href="dashboard.html" class="p-2 text-slate-400 hover:text-white transition">
                <i class="fas fa-arrow-left text-xl"></i>
            </a>
            <h1 class="flex-1 text-center text-lg font-bold text-white">Withdraw Money</h1>
            <a href="history.html" class="p-2 text-slate-400 hover:text-white transition">
                <i class="fas fa-history text-xl"></i>
            </a>
        </div>
    </header>

    <main class="max-w-lg mx-auto px-4 py-6">
        <!-- Wallet Balance -->
        <div class="bg-gradient-to-r from-primary via-purple-600 to-secondary rounded-2xl p-6 mb-6 relative overflow-hidden">
            <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2"></div>
            <div class="relative z-10">
                <p class="text-purple-200 text-sm mb-1">Available Balance</p>
                <h2 class="text-4xl font-bold text-white mb-2">₹<span id="walletBalance">0.00</span></h2>
                <p class="text-purple-200 text-sm">
                    <i class="fas fa-info-circle mr-1"></i>Min withdrawal: ₹50
                </p>
            </div>
        </div>

        <!-- Withdrawal Method Selection -->
        <h3 class="text-lg font-bold text-white mb-3">
            <i class="fas fa-credit-card text-primary mr-2"></i>Select Payment Method
        </h3>

        <div class="space-y-3 mb-6">
            <!-- UPI -->
            <label class="payment-option flex items-center gap-4 bg-slate-800/50 backdrop-blur rounded-xl p-4 border border-slate-700/50 cursor-pointer hover:border-primary/50 transition">
                <input type="radio" name="paymentMethod" value="upi" class="hidden" onchange="selectPaymentMethod('upi')">
                <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-emerald-500 rounded-xl flex items-center justify-center">
                    <i class="fas fa-mobile-alt text-xl text-white"></i>
                </div>
                <div class="flex-1">
                    <h4 class="text-white font-semibold">UPI</h4>
                    <p class="text-slate-400 text-sm">Google Pay, PhonePe, Paytm UPI</p>
                </div>
                <div class="w-6 h-6 rounded-full border-2 border-slate-600 flex items-center justify-center payment-radio">
                    <div class="w-3 h-3 rounded-full bg-primary hidden check-dot"></div>
                </div>
            </label>

            <!-- Paytm Wallet -->
            <label class="payment-option flex items-center gap-4 bg-slate-800/50 backdrop-blur rounded-xl p-4 border border-slate-700/50 cursor-pointer hover:border-primary/50 transition">
                <input type="radio" name="paymentMethod" value="paytm" class="hidden" onchange="selectPaymentMethod('paytm')">
                <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-xl flex items-center justify-center">
                    <i class="fas fa-wallet text-xl text-white"></i>
                </div>
                <div class="flex-1">
                    <h4 class="text-white font-semibold">Paytm Wallet</h4>
                    <p class="text-slate-400 text-sm">Transfer to Paytm wallet</p>
                </div>
                <div class="w-6 h-6 rounded-full border-2 border-slate-600 flex items-center justify-center payment-radio">
                    <div class="w-3 h-3 rounded-full bg-primary hidden check-dot"></div>
                </div>
            </label>

            <!-- Bank Transfer -->
            <label class="payment-option flex items-center gap-4 bg-slate-800/50 backdrop-blur rounded-xl p-4 border border-slate-700/50 cursor-pointer hover:border-primary/50 transition">
                <input type="radio" name="paymentMethod" value="bank" class="hidden" onchange="selectPaymentMethod('bank')">
                <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl flex items-center justify-center">
                    <i class="fas fa-university text-xl text-white"></i>
                </div>
                <div class="flex-1">
                    <h4 class="text-white font-semibold">Bank Transfer</h4>
                    <p class="text-slate-400 text-sm">Direct bank account transfer</p>
                </div>
                <div class="w-6 h-6 rounded-full border-2 border-slate-600 flex items-center justify-center payment-radio">
                    <div class="w-3 h-3 rounded-full bg-primary hidden check-dot"></div>
                </div>
            </label>
        </div>

        <!-- Payment Details Form -->
        <div id="paymentForm" class="hidden mb-6">
            <!-- UPI Form -->
            <div id="upiForm" class="hidden bg-slate-800/50 backdrop-blur rounded-xl p-4 border border-slate-700/50">
                <h4 class="text-white font-semibold mb-4">Enter UPI ID</h4>
                <input type="text" id="upiId" placeholder="yourname@upi" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-primary mb-3">
                <p class="text-slate-400 text-sm"><i class="fas fa-info-circle mr-1"></i>Example: 9876543210@paytm, name@oksbi</p>
            </div>

            <!-- Paytm Form -->
            <div id="paytmForm" class="hidden bg-slate-800/50 backdrop-blur rounded-xl p-4 border border-slate-700/50">
                <h4 class="text-white font-semibold mb-4">Enter Paytm Number</h4>
                <div class="flex">
                    <span class="bg-slate-700 border border-slate-600 border-r-0 rounded-l-xl px-4 py-3 text-slate-400">+91</span>
                    <input type="tel" id="paytmNumber" maxlength="10" placeholder="Enter mobile number" class="flex-1 bg-slate-900/50 border border-slate-700 rounded-r-xl px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-primary">
                </div>
            </div>

            <!-- Bank Form -->
            <div id="bankForm" class="hidden bg-slate-800/50 backdrop-blur rounded-xl p-4 border border-slate-700/50 space-y-4">
                <h4 class="text-white font-semibold">Bank Account Details</h4>
                <div>
                    <label class="block text-slate-400 text-sm mb-2">Account Holder Name</label>
                    <input type="text" id="accountName" placeholder="As per bank records" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-primary">
                </div>
                <div>
                    <label class="block text-slate-400 text-sm mb-2">Account Number</label>
                    <input type="text" id="accountNumber" placeholder="Enter account number" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-primary">
                </div>
                <div>
                    <label class="block text-slate-400 text-sm mb-2">IFSC Code</label>
                    <input type="text" id="ifscCode" placeholder="e.g., SBIN0001234" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-primary uppercase">
                </div>
                <div>
                    <label class="block text-slate-400 text-sm mb-2">Bank Name</label>
                    <input type="text" id="bankName" placeholder="e.g., State Bank of India" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-primary">
                </div>
            </div>
        </div>

        <!-- Amount Selection -->
        <div id="amountSection" class="hidden mb-6">
            <h3 class="text-lg font-bold text-white mb-3">
                <i class="fas fa-rupee-sign text-green-400 mr-2"></i>Select Amount
            </h3>

            <div class="grid grid-cols-3 gap-3 mb-4">
                <button onclick="selectAmount(50)" class="amount-btn bg-slate-800/50 border border-slate-700/50 py-3 rounded-xl text-white font-medium hover:border-primary hover:bg-primary/10 transition">
                    ₹50
                </button>
                <button onclick="selectAmount(100)" class="amount-btn bg-slate-800/50 border border-slate-700/50 py-3 rounded-xl text-white font-medium hover:border-primary hover:bg-primary/10 transition">
                    ₹100
                </button>
                <button onclick="selectAmount(200)" class="amount-btn bg-slate-800/50 border border-slate-700/50 py-3 rounded-xl text-white font-medium hover:border-primary hover:bg-primary/10 transition">
                    ₹200
                </button>
                <button onclick="selectAmount(500)" class="amount-btn bg-slate-800/50 border border-slate-700/50 py-3 rounded-xl text-white font-medium hover:border-primary hover:bg-primary/10 transition">
                    ₹500
                </button>
                <button onclick="selectAmount(1000)" class="amount-btn bg-slate-800/50 border border-slate-700/50 py-3 rounded-xl text-white font-medium hover:border-primary hover:bg-primary/10 transition">
                    ₹1000
                </button>
                <button onclick="selectAmount('all')" class="amount-btn bg-slate-800/50 border border-slate-700/50 py-3 rounded-xl text-white font-medium hover:border-primary hover:bg-primary/10 transition">
                    All
                </button>
            </div>

            <div class="bg-slate-800/50 backdrop-blur rounded-xl p-4 border border-slate-700/50">
                <label class="block text-slate-400 text-sm mb-2">Or enter custom amount</label>
                <div class="flex">
                    <span class="bg-slate-700 border border-slate-600 border-r-0 rounded-l-xl px-4 py-3 text-slate-400">₹</span>
                    <input type="number" id="customAmount" min="50" placeholder="Enter amount" class="flex-1 bg-slate-900/50 border border-slate-700 rounded-r-xl px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-primary">
                </div>
            </div>
        </div>

        <!-- Withdrawal Summary -->
        <div id="summarySection" class="hidden bg-slate-800/50 backdrop-blur rounded-xl p-4 border border-slate-700/50 mb-6">
            <h4 class="text-white font-semibold mb-3">Withdrawal Summary</h4>
            <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                    <span class="text-slate-400">Amount</span>
                    <span class="text-white" id="summaryAmount">₹0</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-slate-400">Processing Fee</span>
                    <span class="text-green-400">FREE</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-slate-400">Method</span>
                    <span class="text-white" id="summaryMethod">-</span>
                </div>
                <div class="border-t border-slate-700 pt-2 mt-2 flex justify-between">
                    <span class="text-white font-semibold">You'll Receive</span>
                    <span class="text-green-400 font-bold" id="summaryTotal">₹0</span>
                </div>
            </div>
        </div>

        <!-- Processing Time Info -->
        <div class="bg-blue-500/10 border border-blue-500/30 rounded-xl p-4 mb-6">
            <div class="flex items-start gap-3">
                <i class="fas fa-clock text-blue-400 mt-1"></i>
                <div>
                    <h4 class="text-white font-medium">Processing Time</h4>
                    <p class="text-slate-400 text-sm">
                        UPI/Paytm: Instant to 1 hour<br>
                        Bank Transfer: 1-3 business days
                    </p>
                </div>
            </div>
        </div>

        <!-- Submit Button -->
        <button onclick="submitWithdrawal()" id="withdrawBtn" class="w-full bg-gradient-to-r from-green-500 to-emerald-500 py-4 rounded-xl text-white font-semibold text-lg hover:opacity-90 transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>
            <i class="fas fa-paper-plane mr-2"></i>Withdraw Now
        </button>

        <!-- KYC Warning -->
        <div id="kycWarning" class="hidden mt-4 bg-yellow-500/10 border border-yellow-500/30 rounded-xl p-4">
            <div class="flex items-start gap-3">
                <i class="fas fa-exclamation-triangle text-yellow-400 mt-1"></i>
                <div>
                    <h4 class="text-white font-medium">KYC Required</h4>
                    <p class="text-slate-400 text-sm mb-2">Complete KYC verification to withdraw more than ₹500</p>
                    <a href="profile.html" class="text-yellow-400 text-sm hover:underline">Complete KYC →</a>
                </div>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-slate-900/95 backdrop-blur-lg border-t border-slate-700/50 z-40">
        <div class="max-w-lg mx-auto px-4">
            <div class="flex items-center justify-around py-2">
                <a href="index.html" class="flex flex-col items-center py-2 px-4 text-slate-400 hover:text-white transition">
                    <i class="fas fa-home text-xl mb-1"></i>
                    <span class="text-xs">Home</span>
                </a>
                <a href="tasks.html" class="flex flex-col items-center py-2 px-4 text-slate-400 hover:text-white transition">
                    <i class="fas fa-tasks text-xl mb-1"></i>
                    <span class="text-xs">Earn</span>
                </a>
                <a href="wallet.html" class="flex flex-col items-center py-2 px-4 text-primary">
                    <i class="fas fa-wallet text-xl mb-1"></i>
                    <span class="text-xs">Wallet</span>
                </a>
                <a href="referral.html" class="flex flex-col items-center py-2 px-4 text-slate-400 hover:text-white transition">
                    <i class="fas fa-users text-xl mb-1"></i>
                    <span class="text-xs">Refer</span>
                </a>
                <a href="profile.html" class="flex flex-col items-center py-2 px-4 text-slate-400 hover:text-white transition">
                    <i class="fas fa-user text-xl mb-1"></i>
                    <span class="text-xs">Profile</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- Processing Modal -->
    <div id="processingModal" class="hidden fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-slate-800 rounded-2xl p-8 text-center max-w-sm w-full">
            <div class="w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <h3 class="text-xl font-bold text-white mb-2">Processing...</h3>
            <p class="text-slate-400">Please wait while we process your withdrawal</p>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="hidden fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-slate-800 rounded-2xl p-8 text-center max-w-sm w-full">
            <div class="w-20 h-20 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-check-circle text-4xl text-green-500"></i>
            </div>
            <h3 class="text-xl font-bold text-white mb-2">Withdrawal Successful!</h3>
            <p class="text-slate-400 mb-4">Your withdrawal request has been submitted</p>
            <div class="bg-slate-700/50 rounded-xl p-4 mb-6">
                <p class="text-slate-400 text-sm mb-1">Transaction ID</p>
                <p class="text-white font-mono" id="txnId">TXN123456789</p>
            </div>
            <button onclick="closeSuccessModal()" class="w-full bg-gradient-to-r from-primary to-secondary py-3 rounded-xl text-white font-medium">
                Done
            </button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCPvpgRkqIEdpmrvKWh-GBS04BQj2_8SAI",
            authDomain: "earning-app-c048f.firebaseapp.com",
            databaseURL: "https://earning-app-c048f-default-rtdb.firebaseio.com",
            projectId: "earning-app-c048f",
            storageBucket: "earning-app-c048f.firebasestorage.app",
            messagingSenderId: "843375564973",
            appId: "1:843375564973:web:xxxxxx"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let walletBalance = 0;
        let selectedMethod = null;
        let selectedAmount = 0;

        // Load wallet balance
        const userId = localStorage.getItem('userId');
        if (userId) {
            database.ref('users/' + userId + '/wallet').on('value', (snapshot) => {
                walletBalance = snapshot.val() || 0;
                document.getElementById('walletBalance').textContent = walletBalance.toFixed(2);
            });
        }

        function selectPaymentMethod(method) {
            selectedMethod = method;

            // Update radio buttons
            document.querySelectorAll('.payment-option').forEach(opt => {
                opt.classList.remove('border-primary');
                opt.querySelector('.payment-radio').classList.remove('border-primary');
                opt.querySelector('.check-dot').classList.add('hidden');
            });

            const selectedOption = document.querySelector(`input[value="${method}"]`).closest('.payment-option');
            selectedOption.classList.add('border-primary');
            selectedOption.querySelector('.payment-radio').classList.add('border-primary');
            selectedOption.querySelector('.check-dot').classList.remove('hidden');

            // Show payment form
            document.getElementById('paymentForm').classList.remove('hidden');
            document.getElementById('upiForm').classList.add('hidden');
            document.getElementById('paytmForm').classList.add('hidden');
            document.getElementById('bankForm').classList.add('hidden');
            document.getElementById(`${method}Form`).classList.remove('hidden');

            // Show amount section
            document.getElementById('amountSection').classList.remove('hidden');

            updateSummary();
        }

        function selectAmount(amount) {
            if (amount === 'all') {
                selectedAmount = walletBalance;
            } else {
                selectedAmount = amount;
            }

            // Update amount buttons
            document.querySelectorAll('.amount-btn').forEach(btn => {
                btn.classList.remove('border-primary', 'bg-primary/10');
            });
            event.target.classList.add('border-primary', 'bg-primary/10');

            document.getElementById('customAmount').value = selectedAmount;

            updateSummary();
        }

        // Custom amount input
        document.getElementById('customAmount').addEventListener('input', function() {
            selectedAmount = parseFloat(this.value) || 0;
            document.querySelectorAll('.amount-btn').forEach(btn => {
                btn.classList.remove('border-primary', 'bg-primary/10');
            });
            updateSummary();
        });

        function updateSummary() {
            if (!selectedMethod || selectedAmount < 50) {
                document.getElementById('summarySection').classList.add('hidden');
                document.getElementById('withdrawBtn').disabled = true;
                return;
            }

            if (selectedAmount > walletBalance) {
                alert('Insufficient balance!');
                document.getElementById('withdrawBtn').disabled = true;
                return;
            }

            document.getElementById('summarySection').classList.remove('hidden');
            document.getElementById('summaryAmount').textContent = '₹' + selectedAmount;
            document.getElementById('summaryTotal').textContent = '₹' + selectedAmount;

            const methodNames = {
                upi: 'UPI',
                paytm: 'Paytm Wallet',
                bank: 'Bank Transfer'
            };
            document.getElementById('summaryMethod').textContent = methodNames[selectedMethod];

            // Check KYC for large withdrawals
            if (selectedAmount > 500) {
                document.getElementById('kycWarning').classList.remove('hidden');
            } else {
                document.getElementById('kycWarning').classList.add('hidden');
            }

            document.getElementById('withdrawBtn').disabled = false;
        }

        function submitWithdrawal() {
            // Validate payment details
            if (selectedMethod === 'upi') {
                const upiId = document.getElementById('upiId').value;
                if (!upiId || !upiId.includes('@')) {
                    alert('Please enter a valid UPI ID');
                    return;
                }
            } else if (selectedMethod === 'paytm') {
                const paytmNumber = document.getElementById('paytmNumber').value;
                if (!paytmNumber || paytmNumber.length !== 10) {
                    alert('Please enter a valid 10-digit Paytm number');
                    return;
                }
            } else if (selectedMethod === 'bank') {
                const accountName = document.getElementById('accountName').value;
                const accountNumber = document.getElementById('accountNumber').value;
                const ifscCode = document.getElementById('ifscCode').value;
                if (!accountName || !accountNumber || !ifscCode) {
                    alert('Please fill all bank details');
                    return;
                }
            }

            // Show processing modal
            document.getElementById('processingModal').classList.remove('hidden');

            // Simulate processing
            setTimeout(() => {
                document.getElementById('processingModal').classList.add('hidden');

                // Generate transaction ID
                const txnId = 'TXN' + Date.now();
                document.getElementById('txnId').textContent = txnId;

                // Show success modal
                document.getElementById('successModal').classList.remove('hidden');

                // Update wallet balance (in production, this would be done server-side)
                if (userId) {
                    database.ref('users/' + userId).update({
                        wallet: walletBalance - selectedAmount
                    });

                    // Add to withdrawals history
                    database.ref('withdrawals/' + userId).push({
                        amount: selectedAmount,
                        method: selectedMethod,
                        status: 'pending',
                        txnId: txnId,
                        timestamp: Date.now()
                    });
                }
            }, 2000);
        }

        function closeSuccessModal() {
            document.getElementById('successModal').classList.add('hidden');
            window.location.href = 'dashboard.html';
        }
    </script>
</body>
</html>
