<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dashboard - EarnZone</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'poppins': ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        primary: '#6366f1',
                        secondary: '#8b5cf6',
                        accent: '#22c55e',
                        dark: '#0f172a',
                    }
                }
            }
        }
    </script>
</head>
<body class="font-poppins bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen pb-20">
    <!-- Header -->
    <header class="bg-slate-900/80 backdrop-blur-lg sticky top-0 z-40 border-b border-slate-700/50">
        <div class="max-w-lg mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-primary to-secondary rounded-full flex items-center justify-center text-white font-bold" id="userAvatar">
                        U
                    </div>
                    <div>
                        <p class="text-white font-semibold" id="userName">Loading...</p>
                        <div class="flex items-center gap-1 text-xs text-yellow-400">
                            <i class="fas fa-fire"></i>
                            <span id="userStreak">0 Day Streak</span>
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <button onclick="location.href='notifications.html'" class="relative p-2 text-slate-400 hover:text-white transition">
                        <i class="fas fa-bell text-xl"></i>
                        <span class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full text-xs text-white flex items-center justify-center" id="notificationCount">0</span>
                    </button>
                    <button onclick="location.href='support.html'" class="p-2 text-slate-400 hover:text-white transition">
                        <i class="fas fa-headset text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-lg mx-auto px-4 py-6">
        <!-- Wallet Card -->
        <div class="bg-gradient-to-r from-primary via-purple-600 to-secondary rounded-2xl p-6 mb-6 relative overflow-hidden">
            <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2"></div>
            <div class="absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full translate-y-1/2 -translate-x-1/2"></div>

            <div class="relative z-10">
                <p class="text-purple-200 text-sm mb-1">Available Balance</p>
                <h2 class="text-4xl font-bold text-white mb-4">â‚¹<span id="walletBalance">0.00</span></h2>

                <div class="flex gap-3">
                    <button onclick="location.href='withdraw.html'" class="flex-1 bg-white/20 backdrop-blur py-3 rounded-xl text-white font-medium hover:bg-white/30 transition">
                        <i class="fas fa-wallet mr-2"></i>Withdraw
                    </button>
                    <button onclick="location.href='history.html'" class="flex-1 bg-white/20 backdrop-blur py-3 rounded-xl text-white font-medium hover:bg-white/30 transition">
                        <i class="fas fa-history mr-2"></i>History
                    </button>
                </div>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="grid grid-cols-3 gap-3 mb-6">
            <div class="bg-slate-800/50 backdrop-blur rounded-xl p-3 text-center border border-slate-700/50">
                <div class="text-green-400 font-bold text-lg" id="todayEarnings">â‚¹0</div>
                <div class="text-slate-400 text-xs">Today</div>
            </div>
            <div class="bg-slate-800/50 backdrop-blur rounded-xl p-3 text-center border border-slate-700/50">
                <div class="text-blue-400 font-bold text-lg" id="weekEarnings">â‚¹0</div>
                <div class="text-slate-400 text-xs">This Week</div>
            </div>
            <div class="bg-slate-800/50 backdrop-blur rounded-xl p-3 text-center border border-slate-700/50">
                <div class="text-purple-400 font-bold text-lg" id="totalEarnings">â‚¹0</div>
                <div class="text-slate-400 text-xs">Total</div>
            </div>
        </div>

        <!-- Daily Check-in -->
        <div class="bg-slate-800/50 backdrop-blur rounded-2xl p-4 mb-6 border border-slate-700/50">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-xl flex items-center justify-center">
                        <i class="fas fa-calendar-check text-xl text-white"></i>
                    </div>
                    <div>
                        <h3 class="text-white font-semibold">Daily Check-in</h3>
                        <p class="text-slate-400 text-sm">Day <span id="currentDay">1</span> of 7</p>
                    </div>
                </div>
                <button onclick="claimDailyBonus()" id="claimBtn" class="bg-gradient-to-r from-yellow-500 to-orange-500 px-4 py-2 rounded-xl text-white font-medium">
                    Claim â‚¹<span id="dailyAmount">10</span>
                </button>
            </div>

            <!-- Week Progress -->
            <div class="flex justify-between gap-1">
                <div class="flex-1 text-center">
                    <div class="w-8 h-8 mx-auto mb-1 rounded-full bg-green-500 flex items-center justify-center text-white text-xs"><i class="fas fa-check"></i></div>
                    <p class="text-slate-400 text-xs">Day 1</p>
                    <p class="text-green-400 text-xs">â‚¹10</p>
                </div>
                <div class="flex-1 text-center" id="day2">
                    <div class="w-8 h-8 mx-auto mb-1 rounded-full bg-slate-700 flex items-center justify-center text-slate-400 text-xs">2</div>
                    <p class="text-slate-400 text-xs">Day 2</p>
                    <p class="text-slate-500 text-xs">â‚¹15</p>
                </div>
                <div class="flex-1 text-center" id="day3">
                    <div class="w-8 h-8 mx-auto mb-1 rounded-full bg-slate-700 flex items-center justify-center text-slate-400 text-xs">3</div>
                    <p class="text-slate-400 text-xs">Day 3</p>
                    <p class="text-slate-500 text-xs">â‚¹20</p>
                </div>
                <div class="flex-1 text-center" id="day4">
                    <div class="w-8 h-8 mx-auto mb-1 rounded-full bg-slate-700 flex items-center justify-center text-slate-400 text-xs">4</div>
                    <p class="text-slate-400 text-xs">Day 4</p>
                    <p class="text-slate-500 text-xs">â‚¹25</p>
                </div>
                <div class="flex-1 text-center" id="day5">
                    <div class="w-8 h-8 mx-auto mb-1 rounded-full bg-slate-700 flex items-center justify-center text-slate-400 text-xs">5</div>
                    <p class="text-slate-400 text-xs">Day 5</p>
                    <p class="text-slate-500 text-xs">â‚¹30</p>
                </div>
                <div class="flex-1 text-center" id="day6">
                    <div class="w-8 h-8 mx-auto mb-1 rounded-full bg-slate-700 flex items-center justify-center text-slate-400 text-xs">6</div>
                    <p class="text-slate-400 text-xs">Day 6</p>
                    <p class="text-slate-500 text-xs">â‚¹40</p>
                </div>
                <div class="flex-1 text-center" id="day7">
                    <div class="w-8 h-8 mx-auto mb-1 rounded-full bg-slate-700 flex items-center justify-center text-yellow-400 text-xs"><i class="fas fa-gift"></i></div>
                    <p class="text-slate-400 text-xs">Day 7</p>
                    <p class="text-yellow-400 text-xs">â‚¹100</p>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <h3 class="text-lg font-bold text-white mb-3">
            <i class="fas fa-bolt text-yellow-400 mr-2"></i>Quick Earn
        </h3>

        <div class="grid grid-cols-4 gap-3 mb-6">
            <a href="tasks.html" class="bg-slate-800/50 backdrop-blur rounded-xl p-3 text-center border border-slate-700/50 hover:border-primary/50 transition">
                <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-xl flex items-center justify-center mx-auto mb-2">
                    <i class="fas fa-tasks text-white"></i>
                </div>
                <p class="text-white text-xs">Tasks</p>
                <p class="text-green-400 text-xs">50+</p>
            </a>
            <a href="surveys.html" class="bg-slate-800/50 backdrop-blur rounded-xl p-3 text-center border border-slate-700/50 hover:border-primary/50 transition">
                <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl flex items-center justify-center mx-auto mb-2">
                    <i class="fas fa-poll text-white"></i>
                </div>
                <p class="text-white text-xs">Surveys</p>
                <p class="text-green-400 text-xs">25+</p>
            </a>
            <a href="ads.html" class="bg-slate-800/50 backdrop-blur rounded-xl p-3 text-center border border-slate-700/50 hover:border-primary/50 transition">
                <div class="w-10 h-10 bg-gradient-to-r from-red-500 to-orange-500 rounded-xl flex items-center justify-center mx-auto mb-2">
                    <i class="fas fa-play-circle text-white"></i>
                </div>
                <p class="text-white text-xs">Watch Ads</p>
                <p class="text-green-400 text-xs">âˆž</p>
            </a>
            <a href="spin.html" class="bg-slate-800/50 backdrop-blur rounded-xl p-3 text-center border border-slate-700/50 hover:border-primary/50 transition">
                <div class="w-10 h-10 bg-gradient-to-r from-yellow-500 to-amber-500 rounded-xl flex items-center justify-center mx-auto mb-2">
                    <i class="fas fa-dharmachakra text-white"></i>
                </div>
                <p class="text-white text-xs">Spin</p>
                <p class="text-purple-400 text-xs">3 Left</p>
            </a>
        </div>

        <!-- Referral Banner -->
        <div class="bg-gradient-to-r from-green-500/20 to-emerald-500/20 rounded-2xl p-4 mb-6 border border-green-500/30">
            <div class="flex items-center gap-4">
                <div class="w-14 h-14 bg-gradient-to-r from-green-500 to-emerald-500 rounded-2xl flex items-center justify-center">
                    <i class="fas fa-user-plus text-2xl text-white"></i>
                </div>
                <div class="flex-1">
                    <h3 class="text-white font-semibold">Refer & Earn â‚¹50</h3>
                    <p class="text-green-300 text-sm">+ 10% lifetime commission</p>
                </div>
                <a href="referral.html" class="bg-gradient-to-r from-green-500 to-emerald-500 px-4 py-2 rounded-xl text-white text-sm font-medium">
                    Invite
                </a>
            </div>
        </div>

        <!-- Active Tasks -->
        <div class="flex items-center justify-between mb-3">
            <h3 class="text-lg font-bold text-white">
                <i class="fas fa-fire text-orange-400 mr-2"></i>Active Tasks
            </h3>
            <a href="tasks.html" class="text-primary text-sm">View All</a>
        </div>

        <div class="space-y-3 mb-6" id="activeTasks">
            <!-- Task Cards will be loaded here -->
        </div>

        <!-- Leaderboard Preview -->
        <div class="bg-slate-800/50 backdrop-blur rounded-2xl p-4 border border-slate-700/50">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-white font-semibold">
                    <i class="fas fa-trophy text-yellow-400 mr-2"></i>Top Earners
                </h3>
                <a href="leaderboard.html" class="text-primary text-sm">View All</a>
            </div>

            <div class="space-y-3" id="leaderboard">
                <!-- Leaderboard items loaded by JS -->
            </div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-slate-900/95 backdrop-blur-lg border-t border-slate-700/50 z-40">
        <div class="max-w-lg mx-auto px-4">
            <div class="flex items-center justify-around py-2">
                <a href="index.html" class="flex flex-col items-center py-2 px-4 text-slate-400 hover:text-white transition">
                    <i class="fas fa-home text-xl mb-1"></i>
                    <span class="text-xs">Home</span>
                </a>
                <a href="tasks.html" class="flex flex-col items-center py-2 px-4 text-slate-400 hover:text-white transition">
                    <i class="fas fa-tasks text-xl mb-1"></i>
                    <span class="text-xs">Earn</span>
                </a>
                <a href="wallet.html" class="flex flex-col items-center py-2 px-4 text-primary">
                    <i class="fas fa-wallet text-xl mb-1"></i>
                    <span class="text-xs">Wallet</span>
                </a>
                <a href="referral.html" class="flex flex-col items-center py-2 px-4 text-slate-400 hover:text-white transition">
                    <i class="fas fa-users text-xl mb-1"></i>
                    <span class="text-xs">Refer</span>
                </a>
                <a href="profile.html" class="flex flex-col items-center py-2 px-4 text-slate-400 hover:text-white transition">
                    <i class="fas fa-user text-xl mb-1"></i>
                    <span class="text-xs">Profile</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- Daily Bonus Modal -->
    <div id="bonusModal" class="hidden fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-slate-800 rounded-2xl p-8 text-center max-w-sm w-full">
            <div class="w-20 h-20 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce">
                <i class="fas fa-coins text-4xl text-white"></i>
            </div>
            <h3 class="text-2xl font-bold text-white mb-2">Congratulations!</h3>
            <p class="text-slate-400 mb-2">You claimed your daily bonus</p>
            <p class="text-3xl font-bold text-yellow-400 mb-6">â‚¹<span id="claimedAmount">10</span></p>
            <button onclick="closeBonusModal()" class="w-full bg-gradient-to-r from-primary to-secondary py-3 rounded-xl text-white font-medium">
                Awesome!
            </button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCPvpgRkqIEdpmrvKWh-GBS04BQj2_8SAI",
            authDomain: "earning-app-c048f.firebaseapp.com",
            databaseURL: "https://earning-app-c048f-default-rtdb.firebaseio.com",
            projectId: "earning-app-c048f",
            storageBucket: "earning-app-c048f.firebasestorage.app",
            messagingSenderId: "843375564973",
            appId: "1:843375564973:web:xxxxxx"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        let currentUser = null;
        let userData = null;

        // Check Authentication
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                loadUserData(user.uid);
            } else {
                // Check localStorage for phone auth
                const userId = localStorage.getItem('userId');
                if (userId) {
                    loadUserData(userId);
                } else {
                    window.location.href = 'login.html';
                }
            }
        });

        // Load User Data
        function loadUserData(userId) {
            database.ref('users/' + userId).on('value', (snapshot) => {
                userData = snapshot.val();
                if (userData) {
                    updateUI();
                }
            });
        }

        // Update UI
        function updateUI() {
            // User Info
            document.getElementById('userName').textContent = userData.fullName || 'User';
            document.getElementById('userAvatar').textContent = (userData.fullName || 'U')[0].toUpperCase();
            document.getElementById('userStreak').textContent = (userData.streak || 1) + ' Day Streak';

            // Wallet
            document.getElementById('walletBalance').textContent = (userData.wallet || 0).toFixed(2);

            // Earnings Stats
            document.getElementById('todayEarnings').textContent = 'â‚¹' + (userData.todayEarnings || 0);
            document.getElementById('weekEarnings').textContent = 'â‚¹' + (userData.weekEarnings || 0);
            document.getElementById('totalEarnings').textContent = 'â‚¹' + (userData.totalEarnings || 0);

            // Daily Check-in
            const streak = userData.streak || 1;
            document.getElementById('currentDay').textContent = streak > 7 ? streak % 7 || 7 : streak;
            const dailyAmounts = [10, 15, 20, 25, 30, 40, 100];
            const currentDayIndex = (streak - 1) % 7;
            document.getElementById('dailyAmount').textContent = dailyAmounts[currentDayIndex];

            // Check if already claimed today
            const lastClaim = userData.lastDailyClaim;
            const today = new Date().toDateString();
            if (lastClaim === today) {
                document.getElementById('claimBtn').textContent = 'Claimed âœ“';
                document.getElementById('claimBtn').disabled = true;
                document.getElementById('claimBtn').classList.remove('from-yellow-500', 'to-orange-500');
                document.getElementById('claimBtn').classList.add('bg-slate-700');
            }

            // Notifications count
            document.getElementById('notificationCount').textContent = userData.unreadNotifications || 0;

            // Load Active Tasks
            loadActiveTasks();

            // Load Leaderboard
            loadLeaderboard();
        }

        // Daily Bonus Claim
        function claimDailyBonus() {
            const lastClaim = userData.lastDailyClaim;
            const today = new Date().toDateString();

            if (lastClaim === today) {
                alert('You already claimed today\'s bonus!');
                return;
            }

            const streak = userData.streak || 1;
            const dailyAmounts = [10, 15, 20, 25, 30, 40, 100];
            const currentDayIndex = (streak - 1) % 7;
            const amount = dailyAmounts[currentDayIndex];

            const userId = currentUser ? currentUser.uid : localStorage.getItem('userId');

            database.ref('users/' + userId).update({
                wallet: (userData.wallet || 0) + amount,
                totalEarnings: (userData.totalEarnings || 0) + amount,
                todayEarnings: (userData.todayEarnings || 0) + amount,
                streak: streak + 1,
                lastDailyClaim: today
            }).then(() => {
                document.getElementById('claimedAmount').textContent = amount;
                document.getElementById('bonusModal').classList.remove('hidden');

                // Add to transaction history
                database.ref('transactions/' + userId).push({
                    type: 'credit',
                    amount: amount,
                    description: 'Daily Check-in Bonus (Day ' + streak + ')',
                    timestamp: Date.now(),
                    status: 'completed'
                });
            });
        }

        function closeBonusModal() {
            document.getElementById('bonusModal').classList.add('hidden');
        }

        // Load Active Tasks
        function loadActiveTasks() {
            const tasksContainer = document.getElementById('activeTasks');
            const tasks = [
                { title: 'Download & Open App', reward: 15, icon: 'download', color: 'from-blue-500 to-cyan-500', time: '2 min' },
                { title: 'Watch 30 sec Video', reward: 5, icon: 'play-circle', color: 'from-red-500 to-orange-500', time: '30 sec' },
                { title: 'Complete Survey', reward: 25, icon: 'poll', color: 'from-purple-500 to-pink-500', time: '5 min' },
                { title: 'Share on WhatsApp', reward: 10, icon: 'share-alt', color: 'from-green-500 to-emerald-500', time: '1 min' }
            ];

            tasksContainer.innerHTML = tasks.map(task => `
                <a href="tasks.html" class="flex items-center gap-4 bg-slate-800/50 backdrop-blur rounded-xl p-4 border border-slate-700/50 hover:border-primary/50 transition">
                    <div class="w-12 h-12 bg-gradient-to-r ${task.color} rounded-xl flex items-center justify-center">
                        <i class="fas fa-${task.icon} text-xl text-white"></i>
                    </div>
                    <div class="flex-1">
                        <h4 class="text-white font-medium">${task.title}</h4>
                        <p class="text-slate-400 text-sm"><i class="fas fa-clock mr-1"></i>${task.time}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-green-400 font-bold">â‚¹${task.reward}</p>
                        <p class="text-xs text-slate-500">Earn</p>
                    </div>
                </a>
            `).join('');
        }

        // Load Leaderboard
        function loadLeaderboard() {
            const leaderboardContainer = document.getElementById('leaderboard');
            const topEarners = [
                { name: 'Rahul K.', earnings: 45000, rank: 1 },
                { name: 'Priya S.', earnings: 38500, rank: 2 },
                { name: 'Amit G.', earnings: 32000, rank: 3 }
            ];

            const colors = ['from-yellow-500 to-amber-500', 'from-slate-400 to-slate-500', 'from-orange-600 to-orange-700'];
            const medals = ['ðŸ¥‡', 'ðŸ¥ˆ', 'ðŸ¥‰'];

            leaderboardContainer.innerHTML = topEarners.map((user, index) => `
                <div class="flex items-center gap-3 p-2 ${index === 0 ? 'bg-yellow-500/10 rounded-xl' : ''}">
                    <div class="w-8 h-8 bg-gradient-to-r ${colors[index]} rounded-full flex items-center justify-center text-white font-bold text-sm">
                        ${medals[index]}
                    </div>
                    <div class="flex-1">
                        <p class="text-white font-medium text-sm">${user.name}</p>
                        <p class="text-slate-400 text-xs">Total Earned</p>
                    </div>
                    <div class="text-right">
                        <p class="text-green-400 font-semibold">â‚¹${user.earnings.toLocaleString()}</p>
                    </div>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
